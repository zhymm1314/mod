# APIè®¾è®¡æ–‡æ¡£

## ğŸ“¡ RESTful APIè®¾è®¡è§„èŒƒ

### åŸºç¡€è§„èŒƒ
- **åè®®**: HTTPS (ç”Ÿäº§ç¯å¢ƒ)
- **åŸŸå**: api.example.com
- **ç‰ˆæœ¬**: URLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶ `/api/v1/`
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

### URLè®¾è®¡è§„èŒƒ
- **èµ„æºå¯¼å‘**: URLè¡¨ç¤ºèµ„æºï¼ŒåŠ¨è¯è¡¨ç¤ºæ“ä½œ
- **å°å†™å­—æ¯**: å…¨éƒ¨ä½¿ç”¨å°å†™å­—æ¯
- **è¿å­—ç¬¦**: ä½¿ç”¨è¿å­—ç¬¦ `-` è€Œéä¸‹åˆ’çº¿ `_`
- **å¤æ•°å½¢å¼**: é›†åˆèµ„æºä½¿ç”¨å¤æ•°åè¯

```
âœ… æ­£ç¡®ç¤ºä¾‹:
GET /api/v1/users          # è·å–ç”¨æˆ·åˆ—è¡¨
GET /api/v1/users/123      # è·å–ç‰¹å®šç”¨æˆ·
POST /api/v1/users         # åˆ›å»ºç”¨æˆ·
PUT /api/v1/users/123      # æ›´æ–°ç”¨æˆ·
DELETE /api/v1/users/123   # åˆ é™¤ç”¨æˆ·

âŒ é”™è¯¯ç¤ºä¾‹:
GET /api/v1/getUsers       # åŠ¨è¯ä¸åº”å‡ºç°åœ¨URLä¸­
GET /api/v1/user_list      # ä½¿ç”¨ä¸‹åˆ’çº¿
```

## ğŸ”‘ è®¤è¯ç³»ç»ŸAPI

### ç”¨æˆ·æ³¨å†Œ
```http
POST /api/auth/register
Content-Type: application/json

# è¯·æ±‚ä½“
{
  "name": "å¼ ä¸‰",
  "mobile": "13800138000",
  "password": "password123"
}

# å“åº” - æˆåŠŸ (201)
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "mobile": "13800138000",
    "created_at": "2024-12-19T10:00:00Z"
  }
}

# å“åº” - å¤±è´¥ (400)
{
  "code": 4001,
  "message": "æ‰‹æœºå·å·²å­˜åœ¨",
  "data": null
}
```

### ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

# è¯·æ±‚ä½“
{
  "mobile": "13800138000",
  "password": "password123"
}

# å“åº” - æˆåŠŸ (200)
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "name": "å¼ ä¸‰",
      "mobile": "13800138000"
    },
    "expires_at": "2024-12-20T10:00:00Z"
  }
}

# å“åº” - å¤±è´¥ (401)
{
  "code": 4011,
  "message": "æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

### è·å–ç”¨æˆ·ä¿¡æ¯
```http
GET /api/auth/info
Authorization: Bearer {token}

# å“åº” - æˆåŠŸ (200)
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "mobile": "13800138000",
    "created_at": "2024-12-19T10:00:00Z",
    "updated_at": "2024-12-19T10:00:00Z"
  }
}

# å“åº” - æœªè®¤è¯ (401)
{
  "code": 4010,
  "message": "è¯·å…ˆç™»å½•",
  "data": null
}
```

### ç”¨æˆ·ç™»å‡º
```http
POST /api/auth/logout
Authorization: Bearer {token}

# å“åº” - æˆåŠŸ (200)
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ",
  "data": null
}
```

## ğŸ§ª æµ‹è¯•æ¥å£

### å¥åº·æ£€æŸ¥
```http
GET /api/ping

# å“åº” (200)
{
  "code": 200,
  "message": "pong",
  "data": {
    "timestamp": "2024-12-19T10:00:00Z",
    "version": "1.0.0"
  }
}
```

### æµ‹è¯•æ¥å£
```http
GET /api/test

# å“åº” (200)
{
  "code": 200,
  "message": "æµ‹è¯•æ¥å£æ­£å¸¸",
  "data": {
    "server_time": "2024-12-19T10:00:00Z",
    "environment": "development"
  }
}
```

## ğŸ“‹ ç»Ÿä¸€å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“ä¸šåŠ¡æ•°æ®
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 4001,
  "message": "è¯¦ç»†é”™è¯¯ä¿¡æ¯",
  "data": null
}
```

### åˆ†é¡µå“åº”
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "list": [
      // æ•°æ®åˆ—è¡¨
    ],
    "pagination": {
      "page": 1,
      "page_size": 20,
      "total": 100,
      "total_pages": 5
    }
  }
}
```

## ğŸš¨ é”™è¯¯ç å®šä¹‰

### æˆåŠŸçŠ¶æ€ç 
| çŠ¶æ€ç  | HTTPçŠ¶æ€ | è¯´æ˜ |
|--------|----------|------|
| 200 | 200 | è¯·æ±‚æˆåŠŸ |
| 201 | 201 | åˆ›å»ºæˆåŠŸ |

### å®¢æˆ·ç«¯é”™è¯¯ (4xxx)
| é”™è¯¯ç  | HTTPçŠ¶æ€ | é”™è¯¯ä¿¡æ¯ | è¯´æ˜ |
|--------|----------|----------|------|
| 4000 | 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°æ ¼å¼ä¸æ­£ç¡® |
| 4001 | 400 | æ‰‹æœºå·å·²å­˜åœ¨ | æ³¨å†Œæ—¶æ‰‹æœºå·é‡å¤ |
| 4002 | 400 | å¯†ç æ ¼å¼ä¸æ­£ç¡® | å¯†ç ä¸ç¬¦åˆå®‰å…¨è¦æ±‚ |
| 4010 | 401 | è¯·å…ˆç™»å½• | æœªæä¾›è®¤è¯ä¿¡æ¯ |
| 4011 | 401 | æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯ | ç™»å½•å‡­æ®é”™è¯¯ |
| 4012 | 401 | Tokenå·²è¿‡æœŸ | JWT Tokenè¿‡æœŸ |
| 4013 | 401 | Tokenæ— æ•ˆ | JWT Tokenæ ¼å¼é”™è¯¯æˆ–å·²æ’¤é”€ |
| 4030 | 403 | æ— æƒé™è®¿é—® | æƒé™ä¸è¶³ |
| 4040 | 404 | èµ„æºä¸å­˜åœ¨ | è¯·æ±‚çš„èµ„æºæœªæ‰¾åˆ° |
| 4290 | 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | è§¦å‘é™æµ |

### æœåŠ¡å™¨é”™è¯¯ (5xxx)
| é”™è¯¯ç  | HTTPçŠ¶æ€ | é”™è¯¯ä¿¡æ¯ | è¯´æ˜ |
|--------|----------|----------|------|
| 5000 | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æœåŠ¡å™¨å¼‚å¸¸ |
| 5001 | 500 | æ•°æ®åº“é”™è¯¯ | æ•°æ®åº“æ“ä½œå¤±è´¥ |
| 5002 | 500 | ç¼“å­˜æœåŠ¡é”™è¯¯ | Redisæ“ä½œå¤±è´¥ |
| 5030 | 503 | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ | æœåŠ¡ç»´æŠ¤ä¸­ |

## ğŸ”’ è®¤è¯æˆæƒè§„èŒƒ

### JWT Tokenè§„èŒƒ
- **ç®—æ³•**: HS256
- **è¿‡æœŸæ—¶é—´**: 24å°æ—¶
- **åˆ·æ–°ç­–ç•¥**: å®¢æˆ·ç«¯è‡ªåŠ¨åˆ·æ–°
- **å­˜å‚¨ä½ç½®**: HTTP Header Authorization

### Tokenæ ¼å¼
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Tokenè½½è·
```json
{
  "user_id": 1,
  "mobile": "13800138000",
  "iat": 1703145600,
  "exp": 1703232000
}
```

## ğŸ“ è¯·æ±‚éªŒè¯è§„èŒƒ

### å‚æ•°éªŒè¯è§„åˆ™
| å­—æ®µ | ç±»å‹ | å¿…å¡« | é•¿åº¦é™åˆ¶ | æ ¼å¼è¦æ±‚ |
|------|------|------|----------|----------|
| name | string | æ˜¯ | 2-20å­—ç¬¦ | ä¸­è‹±æ–‡æ•°å­— |
| mobile | string | æ˜¯ | 11ä½ | æ‰‹æœºå·æ ¼å¼ |
| password | string | æ˜¯ | 8-20å­—ç¬¦ | åŒ…å«å­—æ¯æ•°å­— |

### éªŒè¯é”™è¯¯å“åº”
```json
{
  "code": 4000,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "data": {
    "errors": [
      {
        "field": "mobile",
        "message": "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®"
      },
      {
        "field": "password",
        "message": "å¯†ç é•¿åº¦è‡³å°‘8ä½"
      }
    ]
  }
}
```

## ğŸŒ CORSè·¨åŸŸé…ç½®

### å…è®¸çš„åŸŸå
```
# å¼€å‘ç¯å¢ƒ
http://localhost:3000
http://127.0.0.1:3000

# ç”Ÿäº§ç¯å¢ƒ
https://yourdomain.com
```

### CORSå¤´è®¾ç½®
```
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
```

## ğŸ“ˆ æ¥å£ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬ç­–ç•¥
- **URLç‰ˆæœ¬**: `/api/v1/`, `/api/v2/`
- **å‘åå…¼å®¹**: è‡³å°‘æ”¯æŒ2ä¸ªç‰ˆæœ¬
- **åºŸå¼ƒç­–ç•¥**: æå‰3ä¸ªæœˆé€šçŸ¥
- **æ–‡æ¡£ç»´æŠ¤**: æ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹æ–‡æ¡£

### ç‰ˆæœ¬ç¤ºä¾‹
```
# å½“å‰ç‰ˆæœ¬
GET /api/v1/users

# æ–°ç‰ˆæœ¬
GET /api/v2/users

# åºŸå¼ƒç‰ˆæœ¬å“åº”
{
  "code": 4003,
  "message": "APIç‰ˆæœ¬å·²åºŸå¼ƒï¼Œè¯·å‡çº§åˆ°v2",
  "data": {
    "current_version": "v1",
    "latest_version": "v2",
    "deprecation_date": "2025-03-01"
  }
}
```

## ğŸ” APIæµ‹è¯•ç¤ºä¾‹

### cURLæµ‹è¯•å‘½ä»¤
```bash
# ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•ç”¨æˆ·","mobile":"13800138000","password":"123456"}'

# ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"mobile":"13800138000","password":"123456"}'

# è·å–ç”¨æˆ·ä¿¡æ¯
curl -X GET http://localhost:8080/api/auth/info \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# å¥åº·æ£€æŸ¥
curl -X GET http://localhost:8080/api/ping
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-19  
**APIè´Ÿè´£äºº**: åç«¯å¼€å‘å·¥ç¨‹å¸ˆ  
**å®¡æ ¸äºº**: æŠ€æœ¯è´Ÿè´£äºº 